!function(t){var e={config:{selector:"select.tl_tagsinput, select.tagsinput, input.tl_tagsinput, input.tagsinput"},init:function(){this.setupTagsInput(),this.setupTagList()},ajaxComplete:function(){this.setupTagsInput(),this.setupTagList()},setupTagsInput:function(){t(this.config.selector).each(function(){var e=t(this);if(e.data("tagsinput"))return!0;var i=e.data("placeholder"),n=e.data("mode"),a=e.data("post-data"),s={queryTokenizer:Bloodhound.tokenizers.whitespace,datumTokenizer:Bloodhound.tokenizers.obj.whitespace("label")},l=e.data(),u={itemValue:function(t){return t.value},itemText:function(t){return t.label},itemTitle:function(t){return t.title},typeaheadjs:[{highlight:l.highlight,minLength:l.highlight?0:1,hint:!0}],confirmKeys:[9,13,188],tagClass:function(t){return t.className?t.className:"label label-info"}},o=t.extend({},u,l);switch(n){case"local":s.local=e.data("items"),s.identify=function(t){return t.value};break;case"remote":s.remote={url:location.href,prepare:function(t,e){return a.query=t,e.type="POST",e.data=a,e.isTagsInputCallback=!0,e},transform:function(t){return t},rateLimitBy:"debounce",rateLimitWait:300}}var p=null;l.highlight&&e.data("highlights")&&t.extend(s,{local:e.data("highlights")});var c=new Bloodhound(s);c.initialize(),o.typeaheadjs[1]={name:"options",displayKey:"label",source:function(t,e,i){""===t?e(null!==p?p.all():c.all()):c.search(t,e,i)}},l.limit>0&&(o.typeaheadjs[1].limit=l.limit);e.tagsinput(o);if(e.siblings(".bootstrap-tagsinput").addClass("tl_select"),(void 0===i||i.length>0)&&e.tagsinput("input").attr("placeholder",i),e.is("select")&&e.find("option:selected").each(function(){e.tagsinput("add",{value:this.value,label:this.text,className:this.className,title:this.value})}),e.tagsinput("input").on("keydown",function(t){9==t.keyCode&&(""!=this.value&&o.freeInput&&e.tagsinput("add",{value:this.value,label:this.value,title:this.value}),t.preventDefault())}),"1"==e.data("submitonchange")&&e.on("itemAdded",function(t){e.closest("form").submit()}),e.tagsinput("input").on("blur",function(t){""!=this.value&&o.freeInput&&(e.tagsinput("add",{value:this.value,label:this.value,title:this.value}),this.value="",e.tagsinput("input").typeahead("val",""))}),e.on("itemAdded",function(t){(void 0===i||i.length>0)&&e.tagsinput("input").val("")}),1!=o.maxTags)new Sortable(e.prev(".bootstrap-tagsinput").get(0),{handle:".tag",onUpdate:function(t){var i=e.find("option");i.length&&e.html(i.move(t.oldIndex,t.newIndex))}})})},setupTagList:function(){t(this.config.selector).each(function(){var e=t(this);e.siblings(".tt-tag-list").find("a").on("click",function(i){var n=t(this).find("span").text(),a=e.siblings(".tl_select").find('[title="'+n+'"]');i.preventDefault(),a.length<1?e.closest("div").find(".tt-input").trigger("focus").val(n).trigger(t.Event("keydown",{keyCode:9})):a.find('[data-role="remove"]').trigger("click")})})}};if(t.fn.move=function(t,e){for(;t<0;)t+=this.length;for(;e<0;)e+=this.length;if(e>=this.length)for(var i=e-this.length;1+i--;)this.push(void 0);return this.splice(e,0,this.splice(t,1)[0]),this},t(function(){e.init()}),t(document).ajaxComplete(function(t,i,n){void 0===n||n.isTagsInputCallback||e.ajaxComplete()}),window.MooTools){var i=[Request,Request.HTML,Request.JSON],n={onSuccess:Request.prototype.onSuccess,onFailure:Request.prototype.onFailure},a={onSuccess:function(){Request.Spy&&"function"==typeof Request.Spy&&Request.Spy.apply(this,arguments),n.onSuccess.apply(this,arguments),e.ajaxComplete()},onFailure:function(){Request.Spy&&"function"==typeof Request.Spy&&Request.Spy.apply(this,arguments),n.onFailure.apply(this,arguments)}};void 0!==Request.Contao&&i.push(Request.Contao),i.invoke("implement",a)}}(jQuery);
